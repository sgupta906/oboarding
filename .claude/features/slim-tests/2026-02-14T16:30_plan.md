# Plan: slim-tests

## Metadata
- **Feature:** slim-tests
- **Created:** 2026-02-14T16:30
- **Status:** plan-complete
- **Based On:** 2026-02-14T16:00_research.md

---

## Architecture Overview

This feature is a pure deletion/trimming operation on test files. No source code changes are needed. No new files are created. The work is organized into two main operations: bulk deletion (15 LOW-value files) and surgical trimming (8 MEDIUM-value files).

```
BEFORE (32 test files, ~13,429 lines)
========================================
 HIGH (9 files, 3,273 lines)  -- KEEP
 LOW  (15 files, 5,436 lines) -- DELETE
 MED  (8 files, 4,720 lines)  -- TRIM to ~2,690 lines

AFTER (17 test files, ~5,963 lines)
========================================
 HIGH (9 files, 3,273 lines)  -- untouched
 MED  (8 files, ~2,690 lines) -- trimmed

Net savings: ~7,466 lines (55.6% reduction)
```

### Data Flow

There is no data flow change. This is a test-only modification. The application source code is untouched.

### Integration Points

None. Test files are leaf nodes in the dependency graph -- they import source modules but nothing imports them.

---

## Tech Stack (Unchanged)

- **Test Framework:** Vitest 4.0.13
- **Test Library:** React Testing Library + jsdom
- **Coverage Tool:** v8 via Vitest
- **Coverage Thresholds:** 80% lines/functions/statements, 75% branches

---

## File Structure

### Files to Delete (15 files, 5,436 lines)

| # | File | Lines | Reason |
|---|------|-------|--------|
| 1 | `src/components/manager/KPISection.test.tsx` | 958 | CSS class assertions |
| 2 | `src/components/manager/KPICard.test.tsx` | 305 | CSS class assertions |
| 3 | `src/components/templates/ModalScrolling.test.tsx` | 347 | CSS class assertions |
| 4 | `src/views/NavigationFlow.integration.test.tsx` | 356 | No-op tests, hash manipulation |
| 5 | `src/views/AuthFlow.integration.test.tsx` | 595 | localStorage round-trips |
| 6 | `src/views/SignInView.integration.test.tsx` | 254 | Overlaps AuthFlow |
| 7 | `src/views/ManagerView.test.tsx` | 431 | Trivial text assertions |
| 8 | `src/views/TemplatesView.test.tsx` | 314 | Heavy mock setup, trivial assertions |
| 9 | `src/components/manager/UsersPanel.test.tsx` | 296 | toBeDefined() assertions |
| 10 | `src/hooks/useActivities.test.ts` | 180 | Cookie-cutter hook test |
| 11 | `src/hooks/useSteps.test.ts` | 169 | Cookie-cutter hook test |
| 12 | `src/hooks/useSuggestions.test.ts` | 168 | Cookie-cutter hook test |
| 13 | `src/hooks/useTemplates.test.ts` | 194 | Cookie-cutter hook test |
| 14 | `src/config/supabase.test.ts` | 80 | Trivial import check |
| 15 | `src/services/roleOperations.test.ts` | 789 | Redundant with roleClient.test.ts |

### Files to Trim (8 files, ~2,030 lines removed)

#### 1. `src/components/modals/RoleModal.test.tsx` (1,316 -> ~716 lines, save ~600)

**KEEP (lines/sections to preserve):**
- Mock data and setup (lines 1-29)
- Create mode: Form Validation - Role Name (lines 97-206) -- all 8 tests
- Create mode: Form Validation - Description (lines 208-255) -- all 3 tests
- Create mode: Form Submission -- "calls onSubmit with valid data" and "trims whitespace" (lines 258-302)
- Create mode: Error Handling -- "does not submit form if there are validation errors" (lines 366-377)
- Edit mode: Form Pre-fill (lines 653-703) -- all 3 tests
- Edit mode: Role Name - Read Only (lines 705-768) -- all 4 tests
- Edit mode: Description Editing -- "allows editing description" (lines 771-788)
- Edit mode: Change Detection -- "shows unsaved changes indicator" and "enables submit button when description changes" (lines 855-912)
- Edit mode: Form Submission -- "calls onSubmit with name and updated description", "submits empty description as undefined", "trims whitespace" (lines 914-984)

**REMOVE:**
- Create mode: Modal Rendering (lines 36-95) -- 6 tests, covered by submission tests
- Create mode: Form Submission -- "disables submit button while submitting", "shows loading state", "disables submit button until form is valid" (lines 304-348)
- Create mode: Error Handling -- "displays server error message" (lines 352-364)
- Create mode: Modal Interaction (lines 379-425) -- 3 tests, trivial callback checks
- Create mode: Accessibility (lines 427-474) -- 4 tests, ARIA attribute checks
- Create mode: User Interactions (lines 476-508) -- 3 tests, basic typing tests
- Create mode: Form State Management (lines 510-527) -- 1 test, re-render test
- Edit mode: Modal Rendering (lines 535-651) -- 8 tests, rendering checks
- Edit mode: Description Editing -- "validates description does not exceed max length", "displays character count", "shows success indicator" (lines 790-853)
- Edit mode: Form Submission -- "shows loading state", "disables buttons while submitting" (lines 986-1015)
- Edit mode: Error Handling (lines 1018-1061) -- 2 tests
- Edit mode: Delete Option (lines 1063-1110) -- 3 tests
- Edit mode: Modal Interaction (lines 1112-1163) -- 2 tests, cancel/reset
- Edit mode: Metadata Display (lines 1165-1207) -- 3 tests, text presence
- Edit mode: Accessibility (lines 1210-1269) -- 3 tests, ARIA checks
- Edit mode: Edge Cases (lines 1272-1314) -- 2 tests, long strings

#### 2. `src/components/modals/CreateOnboardingModal.test.tsx` (836 -> ~436 lines, save ~400)

**KEEP:**
- Mock data and setup (lines 1-113)
- Validation errors section (lines 213-376) -- all 6 tests
- Successful submission (lines 382-468) -- both tests
- Template preview (lines 474-541) -- both tests
- Whitespace trimming test (lines 710-751)

**REMOVE:**
- Visibility tests (lines 119-145) -- 2 tests
- Form fields rendering (lines 151-209) -- 3 tests
- Loading and error states (lines 547-629) -- 5 tests
- Loading state during submission (lines 635-686) -- 2 tests
- Cancel button test (lines 692-708)
- Accessibility section (lines 757-798) -- 2 tests
- Required field indicators (lines 804-835) -- 2 tests

#### 3. `src/components/templates/TemplateModal.test.tsx` (728 -> ~428 lines, save ~300)

**KEEP:**
- Mock data and setup (lines 1-68)
- Create mode: validation tests -- "validate template name is required", "validate at least one role", "validate at least one step" (lines 179-256)
- Create mode: "successfully submit valid form" (lines 258-292)
- Create mode: "allow adding multiple steps" (lines 312-334)
- Create mode: "allow selecting multiple roles" (lines 384-404)
- Edit mode: "pre-fill steps from template" (lines 481-498)
- Edit mode: "pre-populate template name field" (lines 518-535)
- Edit mode: "pre-populate template role" (lines 537-556)
- Edit mode: "allow editing template name" (lines 579-600)
- Edit mode: "submit updated template data" (lines 602-627)
- Edit mode: "allow editing step data" (lines 686-707)

**REMOVE:**
- Create mode: not render / render tests (lines 75-103) -- 2 tests
- Create mode: "show 'Create New Template' title" (lines 105-117)
- Create mode: "start with 1 empty step" (lines 119-132)
- Create mode: "show template name input field" (lines 134-146)
- Create mode: "show role selection checkboxes" (lines 148-162)
- Create mode: "show status radio buttons" (lines 164-177)
- Create mode: "close modal when cancel button" (lines 294-310)
- Create mode: "show step form with required fields" (lines 336-349)
- Create mode: "display error message" (lines 351-364)
- Create mode: "disable submit button when submitting" (lines 366-382)
- Create mode: "set default status to Draft" (lines 406-421)
- Edit mode: not render / render tests (lines 429-461) -- 2 tests
- Edit mode: "show 'Edit Template' title" (lines 463-479)
- Edit mode: "show delete button" (lines 500-516)
- Edit mode: "pre-populate template status" (lines 558-577)
- Edit mode: "close modal when cancel" (lines 629-647)
- Edit mode: "display error message" (lines 649-664)
- Edit mode: "disable save button when submitting" (lines 666-684)
- Edit mode: "have proper form structure" (lines 709-726)

#### 4. `src/components/modals/UserModal.test.tsx` (519 -> ~369 lines, save ~150)

**KEEP:**
- Mock data and setup (lines 1-35)
- Create mode: "validate email field" (lines 86-103)
- Create mode: "validate email format" (lines 105-125)
- Create mode: "validate name field" (lines 127-147)
- Create mode: "validate role selection" (lines 149-166)
- Create mode: "submit form with valid data" (lines 168-201)
- Create mode: "select multiple roles" (lines 203-236)
- Create mode: "select profiles" (lines 238-271)
- Create mode: "trim whitespace from inputs" (lines 321-353)
- Edit mode: "show 'Edit User' title" (lines 361-373)
- Edit mode: "pre-fill form fields from user prop" (lines 376-393)
- Edit mode: "submit form with valid data in edit mode" (lines 441-467)
- Edit mode: "return null when user is null" (lines 426-439)

**REMOVE:**
- Create mode: "render modal when open" (lines 42-56) -- covered by submission test
- Create mode: "not render modal when closed" (lines 58-69)
- Create mode: "show intro section" (lines 72-84)
- Create mode: "display server error" (lines 273-286)
- Create mode: "disable submit button while submitting" (lines 288-302)
- Create mode: "close modal on cancel" (lines 304-319)
- Edit mode: "not show intro section" (lines 395-408)
- Edit mode: "show 'Save Changes' submit button" (lines 410-424)
- Edit mode: "show 'Saving...' loading state" (lines 469-483)
- Edit mode: "close modal on cancel in edit mode" (lines 485-501)
- Edit mode: "display server error in edit mode" (lines 503-517)

#### 5. `src/components/manager/RoleManagementPanel.test.tsx` (490 -> ~290 lines, save ~200)

**KEEP:**
- Mock data and setup (lines 1-68)
- Search and Filter Functionality (lines 130-203) -- all 5 tests
- Edit Modal (lines 292-342) -- all 3 tests
- Delete Confirmation (lines 344-402) -- all 3 tests
- User ID Tracking (lines 483-489) -- 1 test

**REMOVE:**
- Rendering and Layout (lines 70-128) -- 7 tests, basic rendering
- Empty States (lines 205-228) -- 2 tests
- Loading States (lines 230-251) -- 2 tests
- Error Handling (lines 253-289) -- 3 tests
- Callbacks (lines 404-438) -- 2 tests (they just check toBeDefined)
- Accessibility (lines 440-470) -- 3 tests
- Responsive Design (lines 472-481) -- 1 test

#### 6. `src/views/EmployeeView.test.tsx` (322 -> ~172 lines, save ~150)

**KEEP:**
- Mock data and setup (lines 1-77)
- "displays progress bar" (lines 97-106)
- "calculates progress correctly (25%)" (lines 108-114)
- "calculates progress correctly (100%)" (lines 116-126)
- "calculates progress correctly (50%)" (lines 128-138)
- "displays steps with correct status badges" (lines 140-152)
- "does NOT display completion footer when steps are pending" (lines 239-245)
- "displays completion footer when ALL steps are completed" (lines 247-257)
- "does NOT display completion footer when only some steps are completed" (lines 259-270)
- "handles 0 steps gracefully without showing completion footer" (lines 272-282)
- "handles 0 steps without producing NaN" (lines 284-291)
- "does NOT display completion footer if one step is stuck" (lines 293-304)

**REMOVE:**
- "renders welcome header with correct title" (lines 79-86)
- "displays all onboarding steps" (lines 88-95)
- "passes callback functions to child components" (lines 154-161)
- "displays step owner and expert information" (lines 163-173)
- "displays step descriptions" (lines 175-182)
- "handles empty steps array gracefully" (lines 184-194)
- "handles steps with stuck status showing waiting message" (lines 196-204)
- "displays progress bar with accessibility attributes" (lines 206-214)
- "renders step timeline with proper list role" (lines 216-224)
- "displays status indicator showing completion progress" (lines 226-232)
- "maintains completion footer visibility on all breakpoints" (lines 306-321)

#### 7. `src/hooks/useUsers.test.ts` (311 -> ~161 lines, save ~150)

**KEEP:**
- Mock data and setup (lines 1-53)
- "create a new user successfully" (lines 86-120)
- "handle duplicate email error when creating user" (lines 122-148)
- "update a user successfully" (lines 150-169)
- "handle error when updating user" (lines 171-192)
- "delete a user successfully" (lines 194-209)
- "handle error when deleting user" (lines 211-231)
- "reset error state" (lines 270-299)

**REMOVE:**
- "initialize with empty users and loading state" (lines 55-68)
- "load users on mount" (lines 70-84)
- "fetch a single user by ID" (lines 233-250)
- "handle when user not found" (lines 252-268)
- "unsubscribe on cleanup" (lines 301-310)

#### 8. `src/components/templates/DeleteConfirmDialog.test.tsx` (198 -> ~118 lines, save ~80)

**KEEP:**
- Setup (lines 1-20)
- "display template name in confirmation message" (lines 49-62)
- "display warning message" (lines 64-79)
- "call onCancel when Cancel button is clicked" (lines 109-125)
- "call onConfirm when Delete button is clicked" (lines 127-149)

**REMOVE:**
- "not render when isOpen is false" (lines 23-33)
- "render when isOpen is true" (lines 35-47)
- "have Cancel button" (lines 81-91)
- "have Delete button" (lines 93-107)
- "disable buttons when isDeleting" (lines 151-169)
- "show loading state while deleting" (lines 171-183)
- "display confirmation message with template name" (lines 185-197) -- duplicate of line 49 test

### Files Untouched (9 HIGH-value files, 3,273 lines)

| File | Lines |
|------|-------|
| `src/utils/filterUtils.test.ts` | 343 |
| `src/utils/timeUtils.test.ts` | 55 |
| `src/utils/debounce.test.ts` | 167 |
| `src/services/supabase/mappers.test.ts` | 378 |
| `src/services/roleClient.test.ts` | 608 |
| `src/services/supabase/crudFactory.test.ts` | 559 |
| `src/services/supabase/subscriptionManager.test.ts` | 198 |
| `src/services/authService.test.ts` | 437 |
| `src/config/authContext.test.tsx` | 528 |

---

## Testing Strategy

### Verification Approach

Since this feature is purely about removing/trimming tests, the testing strategy is about ensuring the remaining tests still pass and coverage thresholds are met.

**After Phase 1 (deletions):**
- Run `npx vitest run` -- all remaining tests must pass
- No cross-file dependencies expected (test files are leaf nodes)

**After Phase 2 (trims):**
- Run `npx vitest run` after each file edit -- must pass
- Verify no describe/it block nesting issues from surgical edits

**After Phase 3 (final verification):**
- Run `npx vitest run --coverage` -- check thresholds
- If coverage drops below 80%/75%, adjust thresholds in `vitest.config.ts`
- Run `npx tsc -b` -- ensure no type errors from removed test imports

### Expected Post-Trim Test Suite
- **Files:** 17 (down from 32)
- **Lines:** ~5,963 (down from ~13,429)
- **Estimated tests:** ~300-350 (down from ~650)
- **Test quality:** Higher average value per test (all CSS/boilerplate assertions removed)

### Coverage Threshold Risk
The vitest.config.ts thresholds (80% lines/functions/statements, 75% branches) may need adjustment. The removed tests covered source code that may or may not be covered by remaining tests. If thresholds fail, we lower them to match the new reality -- the remaining tests are higher quality.

---

## Implementation Notes

### Key Decisions

1. **Delete before trim.** Bulk deletions are zero-risk (no chance of syntax errors) and provide the biggest line savings. Getting them done first establishes a clean baseline.

2. **Trim files one at a time.** Each MEDIUM file gets edited and verified independently. This isolates any issues from surgical edits.

3. **Preserve describe/it structure.** When trimming, remove entire `it()` blocks and collapse empty `describe()` wrappers. Do not leave orphaned describe blocks with no tests inside them.

4. **No source code changes.** This feature touches ONLY test files and vitest.config.ts (if coverage thresholds need adjustment). No component, service, hook, or utility source files are modified.

5. **Coverage thresholds are flexible.** If removing tests drops coverage below 80%, we lower the thresholds. The quality of remaining tests (validation logic, business rules, data transformations) is more important than the quantity.

### Patterns

- All test files follow the `describe('Component', () => { describe('Section', () => { it('test', ...) }) })` nesting pattern
- When removing tests, ensure the parent `describe` block still has at least one test, or remove the entire describe block
- Preserve `beforeEach` and mock setup blocks that are shared by remaining tests

### Trade-offs

- **Accepting lower coverage numbers** in exchange for a lean, high-signal test suite
- **Not writing replacement tests** -- the HIGH-value files already cover the core logic paths
- **Not refactoring remaining tests** -- scope is limited to deletion/trimming only

---

## Non-Goals

- Writing new tests
- Refactoring existing test code (beyond removing blocks)
- Modifying application source code
- Changing test infrastructure (setup.ts, test-utils, etc.)
- Adding E2E tests to compensate for removed unit tests
- Changing the test framework or libraries
