# Plan: suggest-edit-indicator

## Metadata
- **Feature:** suggest-edit-indicator
- **Created:** 2026-02-16T23:30
- **Status:** plan-complete
- **Based On:** 2026-02-16T23:30_research.md

## Architecture Overview

Simple prop threading -- same pattern as `readOnly` and `loadingStepIds`.

```
OnboardingHub
  |-- useSuggestions(!isManager)
  |-- useMemo -> stepsWithPendingSuggestions: Set<number>
  |
  v
MemoizedEmployeeView  (+ stepsWithPendingSuggestions prop)
  |
  v
StepTimeline           (+ stepsWithPendingSuggestions prop)
  |
  v
StepCard               (+ hasPendingSuggestion prop)
  |-- Amber Badge: "Feedback Sent" + MessageSquare icon
  |-- Amber ring: ring-2 ring-amber-200 (only when status=pending)
```

## Tech Stack (no changes)

- React 18 + TypeScript, Tailwind CSS, Zustand (existing SuggestionsSlice), Lucide React (MessageSquare)
- No new dependencies

## File Changes

### Modified Files (5)

| File | Change |
|------|--------|
| `src/types/index.ts` (line 179-187) | Add `hasPendingSuggestion?: boolean` to `StepCardProps` |
| `src/components/onboarding/StepCard.tsx` | Import MessageSquare, destructure `hasPendingSuggestion`, render amber Badge + amber ring on pending steps |
| `src/components/onboarding/StepTimeline.tsx` (line 10-17) | Add `stepsWithPendingSuggestions?: Set<number>` to `StepTimelineProps`, forward to StepCard |
| `src/views/EmployeeView.tsx` (line 12-21) | Add `stepsWithPendingSuggestions?: Set<number>` to `EmployeeViewProps`, forward to StepTimeline |
| `src/components/OnboardingHub.tsx` | Import `useSuggestions`, compute Set via useMemo, pass to EmployeeView, add success toast after suggestion submit |

### New Files (0)

None.

### Test Files Modified (2)

| File | Change |
|------|--------|
| `src/components/onboarding/StepTimeline.test.tsx` | Update StepCard mock to capture `hasPendingSuggestion`, add test for prop forwarding |
| `src/views/EmployeeView.test.tsx` | Add test for `stepsWithPendingSuggestions` prop forwarding to StepTimeline |

### Test Files Created (1)

| File | Purpose |
|------|---------|
| `src/components/onboarding/StepCard.test.tsx` | Unit tests for amber badge rendering, amber ring, dark mode classes |

## Component Changes Detail

### StepCard.tsx

1. Import `MessageSquare` from lucide-react
2. Destructure `hasPendingSuggestion` from props
3. Add amber ring to `borderColorMap.pending` when `hasPendingSuggestion` is true:
   ```tsx
   pending: hasPendingSuggestion
     ? 'border-l-brand-500 ring-2 ring-amber-200 dark:ring-amber-800'
     : 'border-l-brand-500',
   ```
4. Add amber Badge after stuck/completed badges:
   ```tsx
   {hasPendingSuggestion && (
     <Badge color="amber" className="inline-flex items-center gap-1">
       <MessageSquare size={14} className="flex-shrink-0" />
       Feedback Sent
     </Badge>
   )}
   ```

### StepTimeline.tsx

Add `stepsWithPendingSuggestions?: Set<number>` to props interface. Forward to StepCard:
```tsx
hasPendingSuggestion={stepsWithPendingSuggestions?.has(step.id)}
```

### EmployeeView.tsx

Add `stepsWithPendingSuggestions?: Set<number>` to props interface. Forward to StepTimeline:
```tsx
stepsWithPendingSuggestions={stepsWithPendingSuggestions}
```

### OnboardingHub.tsx

1. Import `useSuggestions` from hooks
2. After existing hooks, add:
   ```tsx
   const { data: suggestions } = useSuggestions(!isManager);
   ```
3. Compute Set with useMemo:
   ```tsx
   const stepsWithPendingSuggestions = useMemo(
     () => new Set(
       suggestions
         .filter(s => s.status === 'pending' && s.instanceId === employeeInstance?.id)
         .map(s => s.stepId)
     ),
     [suggestions, employeeInstance?.id]
   );
   ```
4. Pass to MemoizedEmployeeView:
   ```tsx
   stepsWithPendingSuggestions={stepsWithPendingSuggestions}
   ```
5. Add success toast in `handleSuggestEdit` after `setActiveModal(null)`:
   ```tsx
   showToast('Suggestion submitted!', 'success');
   ```

## Testing Strategy

### Unit Tests (StepCard.test.tsx) -- NEW FILE, ~6 tests

1. Renders "Feedback Sent" badge when `hasPendingSuggestion=true`
2. Does NOT render badge when `hasPendingSuggestion=false`
3. Does NOT render badge when `hasPendingSuggestion` is undefined
4. Badge has amber color class
5. Amber ring present on pending step with suggestion
6. Dark mode classes present on amber ring

### Unit Tests (StepTimeline.test.tsx) -- ADD ~2 tests

1. Forwards `hasPendingSuggestion=true` to StepCard when step.id is in Set
2. Forwards `hasPendingSuggestion=false` when step.id is not in Set

### Integration Tests (EmployeeView.test.tsx) -- ADD ~1 test

1. Renders "Feedback Sent" badge when `stepsWithPendingSuggestions` contains a step ID

### Total New Tests: ~9

## Implementation Notes

- **Amber ring is additive**: Does not replace the `border-l-brand-500` on pending steps. Uses `ring-2` which is a separate CSS property from `border-l`.
- **Stuck/completed steps**: Badge still renders (e.g., a step could be stuck AND have feedback), but the amber ring only applies to `pending` status to avoid conflicting with rose ring on stuck steps.
- **Manager view**: `useSuggestions(!isManager)` returns empty array for managers. No suggestion badges in manager's employee view (deferred).
- **MemoizedEmployeeView**: The `stepsWithPendingSuggestions` Set reference changes when suggestions change, correctly breaking memo equality.

## Non-Goals

- Manager's employee view showing suggestion badges
- Badge click-to-view suggestion detail
- Animated badge appearance
- Suggestion count per step
