# Research: cleanup

## Metadata
- **Feature:** cleanup
- **Created:** 2026-02-14T09:00
- **Status:** research-complete
- **Researcher:** research-agent
- **Migration Step:** 5 of 5 (Firebase -> Supabase) -- FINAL STEP

## Feature Context

This is the final step in the Firebase-to-Supabase migration. Steps 1-4 are complete:
1. `supabase-setup` (commit 28ea803) -- DB schema, 16 tables, typed client
2. `supabase-data-layer` (commit 9efdfed) -- 8 modular Supabase services replaced monolithic Firebase services
3. `supabase-auth` (commit eade899) -- Supabase Auth replaced Firebase Auth
4. `supabase-realtime` (commit 7f6a9a0) -- Supabase Realtime subscriptions, polling converted

**Goal:** Remove ALL Firebase dependencies, dead code, unused files, stale comments, and simplify the codebase so it is clean, lean, and ready for new feature development.

### What Was Deferred to This Step

From previous research/plan documents:
- Remove `firebase.ts` and `firebase.test.ts` (deferred from supabase-auth)
- Remove `firebase` npm package from dependencies (deferred from supabase-auth)
- Remove `firebase-tools` npm package from devDependencies (deferred from supabase-auth)
- Clean up Firebase config files (`firebase.json`, `firestore.rules`, `firestore.indexes.json`, `storage.rules`)
- Clean up Docker/emulator config (`docker-compose.yml`)
- Clean up Firebase emulator scripts in `package.json`
- Remove Firebase seed script (`scripts/seedTestUsers.ts`)
- Update `.env.template` and `.env.local` to remove Firebase env vars
- Update `.devcontainer/devcontainer.json` to remove Firebase tools
- Update stale "Firestore" comments in type definitions
- Remove `FIXED_deleteUser.ts` (dead code file at root)
- Clean up stale root-level documentation files

### Current State

- **Tests:** 653/653 passing (31 test files)
- **TypeScript:** Zero errors
- **No code imports `config/firebase`** except `firebase.ts` itself and `firebase.test.ts`
- Auth, data layer, and realtime are all fully on Supabase

---

## Requirements

### Functional Requirements
- [x] FR1: Delete `src/config/firebase.ts` (36 lines) -- no code imports it
- [x] FR2: Delete `src/config/firebase.test.ts` (31 lines) -- tests Firebase SDK, no longer needed
- [x] FR3: Remove `firebase` package from `package.json` dependencies
- [x] FR4: Remove `firebase-tools` package from `package.json` devDependencies
- [x] FR5: Remove Firebase emulator scripts from `package.json` (`firebase:emulator`, `firebase:emulator:import`, `firebase:emulator:export`, `docker:emulator`, `docker:emulator:down`, `seed:test-users`)
- [x] FR6: Delete Firebase config files: `firebase.json`, `firestore.rules`, `firestore.indexes.json`, `storage.rules`
- [x] FR7: Delete `docker-compose.yml` (Firebase emulator Docker config)
- [x] FR8: Delete `scripts/seedTestUsers.ts` (Firebase emulator seed script, 190 lines)
- [x] FR9: Delete `FIXED_deleteUser.ts` (dead code reference file at root, 246 lines)
- [x] FR10: Remove all Firebase env vars from `.env.template` and `.env.local`
- [x] FR11: Update `.env.template` to be Supabase-first (it currently shows Firebase as primary)
- [x] FR12: Update `.devcontainer/devcontainer.json` to remove `firebase-tools` install
- [x] FR13: Remove stale `VITE_FIREBASE_PROJECT_ID` reference from `src/test/setup.ts` (line 66)
- [x] FR14: Rename `firestoreCreateRole`/`firestoreUpdateRole`/`firestoreDeleteRole` aliases in `src/services/roleClient.ts` to `supabaseCreateRole`/etc. or just `createRoleInDB`/etc.
- [x] FR15: Rename matching `firestoreCreateRole`/etc. references in `src/services/roleClient.test.ts`
- [x] FR16: Update stale "Firestore" comments in `src/types/index.ts` (8 occurrences of "Maps to Firestore")
- [x] FR17: Update stale "Firestore equivalent" comments in `src/types/database.types.ts` (16 occurrences)
- [x] FR18: Update stale comment in `src/config/supabase.ts` line 5 ("mirrors the pattern established in `firebase.ts`")
- [x] FR19: Update stale comment in `src/App.tsx` line 106 ("Manages Firebase auth state")
- [x] FR20: Update stale comment in `src/data/mockData.ts` line 2 ("simulating Firestore collections")
- [x] FR21: Update stale comment in `src/components/OnboardingHub.tsx` line 3 ("backed by real Firestore data")
- [x] FR22: Update stale comment in `src/services/roleOperations.test.ts` line 28 ("old Firebase/localStorage era")
- [x] FR23: Update stale "Firestore" references in `src/services/roleClient.test.ts` error messages (lines 209, 211, 343, 345, 348, 464, 466, 469, 573, 605, 606)
- [x] FR24: Remove Firebase-related entries from `.gitignore` (lines 140-146: `.firebase/`, `firebase_data/`, `ui-debug.log`, `database-debug.log`)
- [x] FR25: Delete stale log files at root: `firebase-debug.log`, `firestore-debug.log`, `pubsub-debug.log`, `test-output.log`, `test_output.log`
- [x] FR26: Delete stale root documentation files (tracked): `BUG_REPORT.md`, `CLARIFICATION_FINAL_SUMMARY.md`, `CODE_CHANGES.md`, `CRITICAL_FIXES_CODE_EXAMPLES.md`, `CRITICAL_FIXES_INDEX.md`, `CRITICAL_FIXES_QUICK_REFERENCE.md`, `CRITICAL_FIXES_SUMMARY.md`, `DELIVERABLES.md`, `FIXES_IMPLEMENTATION_STATUS.md`, `FIXES_SUMMARY.txt`, `IMPLEMENTATION_FIXES.md`, `IMPLEMENTATION_SUMMARY.txt`, `INDEX.md`, `QUICK_REFERENCE_NEW_USER_VS_NEW_HIRE.md`, `TEMPLATE_SYNC_IMPLEMENTATION.md`, `TEST_SUITE_SUMMARY.md`, `USER_CREATION_WORKFLOW_ANALYSIS.md`, `UX_IMPROVEMENTS_SUMMARY.md`, `VISUAL_CHANGES_REFERENCE.md`
- [x] FR27: Delete stale root files: `exampleCode.js`, `FIXED_deleteUser.ts`
- [x] FR28: Delete stale directories: `docs/` (1 file), `project_status/` (1 file), `tests/fixtures/` (empty/stale)
- [x] FR29: Delete untracked root documentation: `DEMO_ONE_PAGER.txt`, `DEMO_PRESENTATION.md`, `DEMO_PRESENTATION_SHORT.md`
- [x] FR30: Update `CLAUDE.md` placeholder sections with actual project details (build commands, architecture, tech stack)
- [x] FR31: Run `npm install` after removing Firebase packages to update `package-lock.json`
- [x] FR32: All 653 tests must continue passing after cleanup
- [x] FR33: Zero TypeScript errors after cleanup

### Technical Requirements
- [x] TR1: Build must pass (`tsc -b && vite build`) after all changes
- [x] TR2: No import resolution errors after deleting files
- [x] TR3: The `.devcontainer/devcontainer.json` must still work for new developers
- [x] TR4: `.env.template` must serve as a clear guide for new developers to set up Supabase

### Constraints
- Must NOT modify any Supabase service logic (src/services/supabase/*.ts) -- only comments
- Must NOT change auth flow logic (src/services/authService.ts, src/config/authContext.tsx)
- Must NOT change hook logic or component render behavior
- Must NOT change the public API of any module
- Must NOT break any of the 653 passing tests

---

## Existing Code Analysis

### Project State
- **Project exists:** YES -- mature codebase, 31 test files, 653 tests
- **Firebase imports in production code:** ONLY in `src/config/firebase.ts` (self-contained, not imported by anything)
- **Firebase imports in test code:** ONLY in `src/config/firebase.test.ts`
- **Firebase mentioned in comments:** 50+ locations across type files, services, and components

### Files to DELETE (14 files + 3 directories)

| File | Lines | Reason |
|------|-------|--------|
| `src/config/firebase.ts` | 36 | Firebase config -- no imports point to it |
| `src/config/firebase.test.ts` | 31 | Tests Firebase SDK presence -- no longer needed |
| `firebase.json` | 34 | Firebase emulator config |
| `firestore.rules` | 10 | Firestore security rules |
| `firestore.indexes.json` | 3 | Firestore indexes |
| `storage.rules` | 10 | Firebase Storage rules |
| `docker-compose.yml` | 38 | Firebase emulator Docker config |
| `scripts/seedTestUsers.ts` | 190 | Firebase emulator seed script |
| `FIXED_deleteUser.ts` | 246 | Dead code reference (never imported) |
| `exampleCode.js` | ? | Dead code reference |
| `firebase-debug.log` | large | Firebase emulator log |
| `firestore-debug.log` | large | Firestore emulator log |
| `pubsub-debug.log` | small | PubSub emulator log |
| `test-output.log` | large | Stale test log |
| `test_output.log` | large | Stale test log |

Root documentation to delete (19 tracked markdown/text files):
`BUG_REPORT.md`, `CLARIFICATION_FINAL_SUMMARY.md`, `CODE_CHANGES.md`, `CODEX.md`, `CRITICAL_FIXES_CODE_EXAMPLES.md`, `CRITICAL_FIXES_INDEX.md`, `CRITICAL_FIXES_QUICK_REFERENCE.md`, `CRITICAL_FIXES_SUMMARY.md`, `DELIVERABLES.md`, `FIXES_IMPLEMENTATION_STATUS.md`, `FIXES_SUMMARY.txt`, `IMPLEMENTATION_FIXES.md`, `IMPLEMENTATION_SUMMARY.txt`, `INDEX.md`, `QUICK_REFERENCE_NEW_USER_VS_NEW_HIRE.md`, `TEMPLATE_SYNC_IMPLEMENTATION.md`, `TEST_SUITE_SUMMARY.md`, `USER_CREATION_WORKFLOW_ANALYSIS.md`, `UX_IMPROVEMENTS_SUMMARY.md`, `VISUAL_CHANGES_REFERENCE.md`

Untracked documentation to delete:
`DEMO_ONE_PAGER.txt`, `DEMO_PRESENTATION.md`, `DEMO_PRESENTATION_SHORT.md`

Directories to delete:
`docs/` (contains only `profiles.md`), `project_status/` (contains only `tickets.md`), `tests/fixtures/` (contains only a README)

### Files to MODIFY (13 files)

| File | Change | Lines Affected |
|------|--------|---------------|
| `package.json` | Remove `firebase` dep, `firebase-tools` devDep, 6 scripts | Lines 17-22, 25, 49 |
| `.env.template` | Rewrite: Supabase-first, remove all Firebase vars | All 21 lines |
| `.env.local` | Remove Firebase vars (lines 8-19) | Lines 8-19 |
| `.devcontainer/devcontainer.json` | Remove `firebase-tools` install, remove Firebase emulator ports | Lines 11, 12 |
| `src/test/setup.ts` | Remove `VITE_FIREBASE_PROJECT_ID` line | Line 66 |
| `src/services/roleClient.ts` | Rename `firestoreCreateRole`/`firestoreUpdateRole`/`firestoreDeleteRole` aliases | Lines 10-12, 209, 263, 288, 319 |
| `src/services/roleClient.test.ts` | Rename `firestoreCreateRole`/etc. + update "Firestore" error strings | ~40 lines |
| `src/types/index.ts` | Update 8 "Maps to Firestore" comments to "Maps to Supabase" or remove | Lines 3, 16, 38, 52, 81, 115, 135, 241, 256 |
| `src/types/database.types.ts` | Update 16 "Firestore equivalent" comments to just describe the table | 16 comment lines |
| `src/config/supabase.ts` | Remove reference to `firebase.ts` in comment | Line 5 |
| `src/App.tsx` | Update "Manages Firebase auth state" comment | Line 106 |
| `src/data/mockData.ts` | Update "simulating Firestore collections" comment | Line 2 |
| `src/components/OnboardingHub.tsx` | Update "backed by real Firestore data" comment | Line 3 |
| `src/services/roleOperations.test.ts` | Update "old Firebase/localStorage era" comment | Line 28 |
| `.gitignore` | Remove Firebase Emulator section (lines 140-146) | 7 lines |
| `CLAUDE.md` | Fill in placeholder sections with project details | Lines 109-161 |

### Patterns to Follow
- All comment updates should reference "Supabase" or just describe the database table generically
- Import aliases should use generic names (e.g., `createRoleInDB` or `dbCreateRole`) rather than technology-specific names
- `.env.template` should clearly document Supabase config with helpful comments

---

## Risk Assessment

### Technical Risks

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Deleting firebase.ts breaks an unknown import | HIGH | VERY LOW | Grep confirmed zero imports of `config/firebase` from any other file |
| Removing `firebase` package breaks test that transitively imports it | HIGH | LOW | Only `firebase.test.ts` imports Firebase SDK; deleting both file and package together is safe |
| Renaming `firestoreCreateRole` aliases breaks tests | MED | LOW | Update both roleClient.ts AND roleClient.test.ts in same change |
| `.env.local` changes affect running dev instance | LOW | LOW | No live Firebase is connected; env vars are dummy values |
| Removing root docs accidentally removes important documentation | LOW | MED | Keep `README.md`, `CLAUDE.md`, `mvp.md`; delete only clearly stale/one-off analysis files |
| `npm install` after removing packages introduces lockfile conflicts | LOW | LOW | Clean install with existing lockfile structure |
| Test count drops from deleting `firebase.test.ts` | LOW | CERTAIN | Expected: 653 - 3 = 650 tests (firebase.test.ts has 3 tests). This is correct behavior. |

### Complexity
- **Level:** Simple
- **Rationale:**
  1. Zero code logic changes -- only deletions, comment updates, and config changes
  2. No new patterns to invent
  3. All Firebase code is already isolated (not imported by anything)
  4. The `firestoreCreateRole` rename is mechanical (find-and-replace within 2 files)
  5. Comment updates are trivial text changes
  6. All changes are independently verifiable

---

## Open Questions

- [x] Q1: Is `src/config/firebase.ts` imported by any production code?
  - Resolution: NO. Grep confirms zero imports. It was the Firebase config used by the old auth and data layers, but steps 2-3 removed all imports of it. Only `firebase.test.ts` references it.

- [x] Q2: Will removing `firebase` from `package.json` break anything?
  - Resolution: NO. The only files that import from `firebase/*` are `firebase.ts`, `firebase.test.ts`, and `scripts/seedTestUsers.ts` -- all of which are being deleted.

- [x] Q3: Should we keep any root-level documentation files?
  - Resolution: Keep `README.md` (project description), `CLAUDE.md` (agent instructions), `mvp.md` (product spec). Delete all other root markdown/txt files -- they are one-off analysis artifacts from previous work.

- [x] Q4: What about the `tests/fixtures/` directory?
  - Resolution: DELETE. It contains only an empty `profiles/README.md` with no actual test fixtures. All tests use inline mocks.

- [x] Q5: Should `docker-compose.yml` be removed or repurposed for Supabase?
  - Resolution: DELETE. Supabase has its own CLI (`supabase start`) for local development. The Docker Compose file is purely for Firebase emulators.

- [x] Q6: How many tests will we lose by deleting `firebase.test.ts`?
  - Resolution: 3 tests. The file has 3 test cases: "should have required Firebase SDK packages installed", "should export app, auth, firestore, and storage from config", "should have required env variables defined". Expected new total: 650 tests.

- [x] Q7: What should the `firestoreCreateRole` aliases be renamed to?
  - Resolution: Use `dbCreateRole`, `dbUpdateRole`, `dbDeleteRole` -- generic, technology-agnostic names that won't need changing again if the database changes.

- [x] Q8: Should we update `.devcontainer/devcontainer.json` to include Supabase CLI?
  - Resolution: NOT YET. The user's SR engineer will connect to Supabase later. For now, just remove the Firebase tools install. Adding Supabase CLI can be done when the live instance is set up.

- [x] Q9: Are there `.gitkeep` files that should be removed?
  - Resolution: KEEP THEM. The `.gitkeep` files in `src/components/manager/`, `src/components/modals/`, etc. ensure directories are tracked in git. They are harmless and follow standard convention.

---

## Recommended Approach

### Implementation Strategy

This cleanup is purely subtractive (deletions + comment updates + config changes). No logic changes. The safest approach is to work in layers:

1. **Layer 1: Delete dead files** -- Firebase config, scripts, root docs, logs
2. **Layer 2: Update package.json** -- Remove dependencies and scripts, run npm install
3. **Layer 3: Update env and config** -- .env.template, .env.local, .devcontainer, .gitignore
4. **Layer 4: Update source comments** -- Rename aliases, update stale Firestore/Firebase comments
5. **Layer 5: Update CLAUDE.md** -- Fill in project details now that architecture is stable
6. **Layer 6: Verify** -- Run full test suite, tsc -b, verify build

### Order of Work

1. **Delete Firebase source files**
   - `src/config/firebase.ts`
   - `src/config/firebase.test.ts`

2. **Delete Firebase config and infrastructure files**
   - `firebase.json`
   - `firestore.rules`
   - `firestore.indexes.json`
   - `storage.rules`
   - `docker-compose.yml`
   - `scripts/seedTestUsers.ts` (and `scripts/` directory if empty)

3. **Delete dead root-level files**
   - `FIXED_deleteUser.ts`
   - `exampleCode.js`
   - All 19+ stale markdown/txt documentation files
   - All 5 log files
   - `DEMO_ONE_PAGER.txt`, `DEMO_PRESENTATION.md`, `DEMO_PRESENTATION_SHORT.md`
   - `docs/` directory
   - `project_status/` directory
   - `tests/fixtures/` directory

4. **Update package.json**
   - Remove `firebase` from dependencies
   - Remove `firebase-tools` from devDependencies
   - Remove 6 Firebase/Docker scripts
   - Run `npm install` to update lockfile

5. **Update environment and config files**
   - Rewrite `.env.template` as Supabase-only
   - Remove Firebase vars from `.env.local`
   - Update `.devcontainer/devcontainer.json` (remove firebase-tools, update ports)
   - Update `.gitignore` (remove Firebase section)

6. **Update test setup**
   - Remove `VITE_FIREBASE_PROJECT_ID` line from `src/test/setup.ts`

7. **Rename Firestore aliases in roleClient**
   - `src/services/roleClient.ts`: rename `firestoreCreateRole` -> `dbCreateRole`, etc.
   - `src/services/roleClient.test.ts`: rename matching references + update error strings

8. **Update stale comments (mechanical)**
   - `src/types/index.ts`: 8 "Maps to Firestore" -> "Maps to Supabase"
   - `src/types/database.types.ts`: 16 "Firestore equivalent" -> remove or simplify
   - `src/config/supabase.ts`: Remove firebase.ts reference
   - `src/App.tsx`: Update "Firebase auth" comment
   - `src/data/mockData.ts`: Update "Firestore collections" comment
   - `src/components/OnboardingHub.tsx`: Update "Firestore data" comment
   - `src/services/roleOperations.test.ts`: Update "Firebase/localStorage era" comment

9. **Update CLAUDE.md**
   - Fill in Project Overview, Technical Stack, Build & Run Commands, Architecture, Testing Requirements

10. **Verify everything**
    - `npx vitest run` -- expect 650 tests passing (3 fewer from deleted firebase.test.ts)
    - `npx tsc -b` -- zero errors
    - `npx vite build` -- clean build

### What to Defer
- **Supabase CLI setup in devcontainer** -- Wait for SR engineer to connect live instance
- **RLS policy configuration** -- Requires live Supabase instance
- **Further code consolidation** -- The codebase is already well-structured; no bloat left to consolidate
- **Advanced Realtime error handling** -- Deferred from step 4, not part of cleanup

---

## File Inventory Summary

### Files to Delete: ~40 files
- 2 Firebase source files (67 lines)
- 4 Firebase config files (97 lines)
- 1 Docker config file (38 lines)
- 1 seed script (190 lines)
- 2 dead root code files
- 5 log files (>1MB total)
- 22 stale documentation files
- 3 stale directories

### Files to Modify: ~15 files
- 1 package.json
- 2 env files
- 1 devcontainer config
- 1 gitignore
- 1 test setup
- 2 roleClient files (aliases + error strings)
- 5 type/comment files
- 1 CLAUDE.md

### Estimated Impact
- **Lines removed:** ~600+ (source files) + ~1,500+ (docs/config)
- **Lines added:** ~50 (CLAUDE.md content, updated comments)
- **Packages removed:** 2 (`firebase`, `firebase-tools`)
- **npm scripts removed:** 6
- **Tests affected:** -3 (firebase.test.ts deleted), expected final count: 650
- **Net result:** Cleaner, leaner codebase with zero Firebase references

---

## Next Step

**All questions resolved. Status: research-complete.**

Run `/plan cleanup` to create the implementation plan with task breakdown.
