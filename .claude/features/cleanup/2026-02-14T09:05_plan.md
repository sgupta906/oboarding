# Plan: cleanup

## Metadata
- **Feature:** cleanup
- **Created:** 2026-02-14T09:05
- **Status:** plan-complete
- **Based On:** 2026-02-14T09:00_research.md
- **Migration Step:** 5 of 5 (Firebase -> Supabase) -- FINAL STEP

---

## Architecture Overview

This is a purely subtractive cleanup. No new architecture is introduced. The goal is to remove every trace of Firebase from the codebase, update stale comments and config, and fill in the CLAUDE.md project documentation.

```
BEFORE (mixed Firebase + Supabase):

  package.json ─── firebase, firebase-tools (unused deps)
  src/config/ ──── firebase.ts (dead), supabase.ts (active)
  src/services/ ── roleClient.ts (firestoreXxx aliases)
  src/types/ ───── index.ts ("Maps to Firestore" comments)
  root/ ────────── 40+ stale files (docs, logs, Firebase config)

AFTER (clean Supabase-only):

  package.json ─── @supabase/supabase-js only
  src/config/ ──── supabase.ts (active)
  src/services/ ── roleClient.ts (dbXxx aliases)
  src/types/ ───── index.ts ("Maps to Supabase" comments)
  root/ ────────── README.md, CLAUDE.md, mvp.md, package.json, etc.
```

### Change Categories

```
  +--------------------------+
  | 1. FILE DELETIONS (~40)  |   Firebase source, config, docs, logs
  +--------------------------+
             |
             v
  +--------------------------+
  | 2. DEPENDENCY REMOVAL    |   firebase, firebase-tools, 6 scripts
  +--------------------------+
             |
             v
  +--------------------------+
  | 3. CONFIG UPDATES        |   .env.template, .env.local, devcontainer, .gitignore
  +--------------------------+
             |
             v
  +--------------------------+
  | 4. SOURCE UPDATES        |   Rename aliases, update comments
  +--------------------------+
             |
             v
  +--------------------------+
  | 5. DOCUMENTATION         |   Fill in CLAUDE.md
  +--------------------------+
             |
             v
  +--------------------------+
  | 6. VERIFICATION          |   Tests, TypeScript, build
  +--------------------------+
```

---

## Tech Stack Summary

No changes to the tech stack. After cleanup:
- **Runtime:** React 18 + TypeScript + Vite
- **Backend:** Supabase (Auth, Database, Realtime)
- **Styling:** Tailwind CSS
- **Testing:** Vitest + React Testing Library
- **Tooling:** ESLint, Prettier

---

## File Structure

### Files to DELETE (40 files + 3 directories)

**Firebase Source (2 files, 67 lines):**
| File | Lines | Reason |
|------|-------|--------|
| `src/config/firebase.ts` | 36 | Firebase SDK config -- zero imports from any other file |
| `src/config/firebase.test.ts` | 31 | Tests Firebase SDK -- 3 tests to be removed |

**Firebase Config (4 files, 97 lines):**
| File | Lines | Reason |
|------|-------|--------|
| `firebase.json` | 34 | Firebase emulator config |
| `firestore.rules` | 10 | Firestore security rules |
| `firestore.indexes.json` | 3 | Firestore indexes |
| `storage.rules` | 10 | Firebase Storage rules |

**Infrastructure (2 files, 228 lines):**
| File | Lines | Reason |
|------|-------|--------|
| `docker-compose.yml` | 38 | Firebase emulator Docker config |
| `scripts/seedTestUsers.ts` | 190 | Firebase emulator seed script |

**Dead Root Code (2 files):**
| File | Reason |
|------|--------|
| `FIXED_deleteUser.ts` | Dead code reference, never imported |
| `exampleCode.js` | Dead code reference |

**Stale Log Files (5 files):**
| File | Reason |
|------|--------|
| `firebase-debug.log` | Firebase emulator log |
| `firestore-debug.log` | Firestore emulator log |
| `pubsub-debug.log` | PubSub emulator log |
| `test-output.log` | Stale test output |
| `test_output.log` | Stale test output |

**Stale Root Documentation (22 tracked + 3 untracked files):**
- `BUG_REPORT.md`, `CLARIFICATION_FINAL_SUMMARY.md`, `CODE_CHANGES.md`, `CODEX.md`
- `CRITICAL_FIXES_CODE_EXAMPLES.md`, `CRITICAL_FIXES_INDEX.md`, `CRITICAL_FIXES_QUICK_REFERENCE.md`, `CRITICAL_FIXES_SUMMARY.md`
- `DELIVERABLES.md`, `FIXES_IMPLEMENTATION_STATUS.md`, `FIXES_SUMMARY.txt`
- `IMPLEMENTATION_FIXES.md`, `IMPLEMENTATION_SUMMARY.txt`, `INDEX.md`
- `QUICK_REFERENCE_NEW_USER_VS_NEW_HIRE.md`, `TEMPLATE_SYNC_IMPLEMENTATION.md`
- `TEST_SUITE_SUMMARY.md`, `USER_CREATION_WORKFLOW_ANALYSIS.md`
- `UX_IMPROVEMENTS_SUMMARY.md`, `VISUAL_CHANGES_REFERENCE.md`
- `DEMO_ONE_PAGER.txt`, `DEMO_PRESENTATION.md`, `DEMO_PRESENTATION_SHORT.md`

**Stale Directories (3):**
| Directory | Contents | Reason |
|-----------|----------|--------|
| `docs/` | `profiles.md` only | Single stale doc |
| `project_status/` | `tickets.md` only | Single stale doc |
| `tests/fixtures/` | `profiles/README.md` only | Empty fixtures, never used |

### Files to MODIFY (15 files)

| File | Change Summary | Lines Affected |
|------|---------------|---------------|
| `package.json` | Remove `firebase` dep, `firebase-tools` devDep, 6 scripts | Lines 17-22, 26, 49 |
| `.env.template` | Rewrite as Supabase-only template (full rewrite) | All 21 lines |
| `.env.local` | Remove lines 8-18 (legacy Firebase vars) | Lines 8-18 |
| `.devcontainer/devcontainer.json` | Remove `firebase-tools` install, remove Firebase ports | Lines 11-12 |
| `src/test/setup.ts` | Remove `VITE_FIREBASE_PROJECT_ID` line | Line 66 |
| `src/services/roleClient.ts` | Rename `firestoreCreateRole`/`firestoreUpdateRole`/`firestoreDeleteRole` to `dbCreateRole`/`dbUpdateRole`/`dbDeleteRole` | Lines 10-12, 209, 263, 288, 319 |
| `src/services/roleClient.test.ts` | Rename matching aliases + update "Firestore" error strings | ~40 lines |
| `src/types/index.ts` | Update 8 "Maps to Firestore" comments to "Maps to Supabase" | Lines 3, 17, 39, 53, 116, 136, 242, 257 |
| `src/types/database.types.ts` | Update 16 "Firestore equivalent" comments to describe tables generically | 16 comment lines |
| `src/config/supabase.ts` | Remove "mirrors the pattern established in `firebase.ts`" | Line 5 |
| `src/App.tsx` | Update "Manages Firebase auth state" comment | Line 106 |
| `src/data/mockData.ts` | Update "simulating Firestore collections" comment | Line 2 |
| `src/components/OnboardingHub.tsx` | Update "backed by real Firestore data" comment | Line 3 |
| `src/services/roleOperations.test.ts` | Update "old Firebase/localStorage era" comment | Line 28 |
| `.gitignore` | Remove "Firebase Emulator" section (lines 139-145) | 7 lines |
| `CLAUDE.md` | Fill in placeholder sections with real project details | Lines 109-161 |

---

## Data Model Changes

None. The database schema (16 Supabase tables) is unchanged. Only comments referencing "Firestore" in the type definition files are updated.

---

## Testing Strategy

### Tests Removed
- `src/config/firebase.test.ts` -- 3 tests (Firebase SDK presence checks) -- no longer relevant

### Tests Modified
- `src/services/roleClient.test.ts` -- Rename `firestoreCreateRole`/`firestoreUpdateRole`/`firestoreDeleteRole` import aliases to `dbCreateRole`/`dbUpdateRole`/`dbDeleteRole`, update "Firestore" error message strings to "database" -- all 45 existing tests must continue passing

### Expected Final Count
- **Before:** 653 tests
- **After:** 650 tests (3 removed from firebase.test.ts)

### Verification Steps
1. `npx vitest run` -- 650 tests passing
2. `npx tsc -b` -- zero TypeScript errors
3. `npx vite build` -- clean production build

---

## Implementation Notes

### Decisions Made

1. **Alias naming convention:** `firestoreXxx` renamed to `dbXxx` (e.g., `dbCreateRole`) rather than `supabaseXxx`. This is technology-agnostic so it will not need renaming again if the backend changes.

2. **Comment style:** "Maps to Firestore 'xxx' collection" becomes "Maps to Supabase 'xxx' table". For `database.types.ts`, "Firestore equivalent: 'xxx' collection" becomes a plain table description (e.g., "System users" instead of "Firestore equivalent: 'users' collection").

3. **CLAUDE.md content:** Will document the actual project details now that the architecture is stable -- React 18, Vite, Supabase, the real build commands, and the actual `src/` directory tree.

4. **`.env.template` rewrite:** Will become Supabase-only with clear documentation for new developers. Firebase vars are completely removed.

5. **Devcontainer:** Remove `firebase-tools` from postCreateCommand. Remove Firebase emulator ports (4000, 8080, 9099, 9199) from forwardPorts. Keep port 5173 (Vite dev server) only.

6. **Java feature in devcontainer:** The Java 17 feature exists for the Firebase emulators. It should be removed along with Firebase tools.

### Patterns Used
- Bulk file deletion via `git rm` (tracked files) and `rm` (untracked files)
- Find-and-replace within scoped files (no global search-replace)
- `npm install` to regenerate lockfile after dependency removal

### Trade-offs
- Deleting 22+ root documentation files is aggressive but correct -- they are all one-off analysis artifacts that are no longer relevant. The `README.md`, `CLAUDE.md`, and `mvp.md` are kept.

---

## Non-Goals

1. **Adding Supabase CLI to devcontainer** -- Deferred until live Supabase instance is connected
2. **RLS policy configuration** -- Requires live Supabase instance
3. **Further code consolidation** -- The 8-service architecture is already clean
4. **Advanced Realtime error handling** -- Deferred from step 4, not cleanup scope
5. **Changing any runtime behavior** -- This is purely deletions, comment updates, and config changes

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| Deleting firebase.ts breaks unknown import | Grep confirmed zero imports -- safe to delete |
| Removing `firebase` package breaks test | Only `firebase.test.ts` imports Firebase SDK -- deleting both together |
| Renaming aliases breaks tests | Update both `roleClient.ts` AND `roleClient.test.ts` in same task |
| `.env.local` changes affect running dev | No live Firebase connected -- env vars are placeholder values |
| npm install after removing deps fails | Clean install against existing lockfile structure |
| Test count drops | Expected: 653 - 3 = 650 tests. This is correct behavior. |
