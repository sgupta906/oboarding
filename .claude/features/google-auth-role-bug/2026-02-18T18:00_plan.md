# Plan: Google OAuth Role Assignment Bug

**Feature:** `google-auth-role-bug`
**Date:** 2026-02-18

## Architecture

This is a 2-file fix with 2 test files updated. No new components or architectural changes.

### Fix 1: NewHiresPanel.tsx — Store "employee" role

When a manager assigns a role+template to an unassigned Google OAuth user, the access-control role stored in `user_roles` should be `"employee"`, not the business role name.

The business role (e.g., "Software Engineer") is already correctly stored in `onboarding_instances.role`.

### Fix 2: authContext.tsx — Instance check on Google re-sign-in

Add a defense-in-depth check in the `onAuthStateChange` handler: if the user has an onboarding instance, force their role to `"employee"` regardless of what `user_roles` says.

This makes the Google OAuth flow consistent with the email sign-in flow.

## Testing Strategy

- Unit test: verify `handleAssignSubmit` passes `'employee'` to `setUserRole`
- Unit test: verify `onAuthStateChange` overrides role to `'employee'` when instance exists
- Playwright: reproduce the full flow (Google sign-in → assign → re-sign-in → verify employee view)
