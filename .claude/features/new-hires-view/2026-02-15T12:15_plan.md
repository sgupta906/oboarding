# Plan: new-hires-view

## Metadata
- **Feature:** new-hires-view
- **Created:** 2026-02-15T12:15
- **Status:** plan-complete
- **Based On:** 2026-02-15T12:00_research.md

---

## Architecture Overview

Replace the 636-line `UsersPanel` (full CRUD user admin) with a ~150-line read-only `NewHiresPanel` that shows employees currently going through onboarding. The new component directly consumes the existing `useOnboardingInstances()` hook -- no user-instance email joining, no CRUD, no modals.

```
Before:                               After:
+-----------+                         +-----------+
|ManagerView|                         |ManagerView|
+-----+-----+                        +-----+-----+
      |                                     |
  tabs: dashboard | roles | users       tabs: dashboard | roles | new-hires
      |                                     |
  UsersPanel (636 lines)              NewHiresPanel (~150 lines)
  - useUsers()                        - useOnboardingInstances()
  - useRoles()                        - Status filter (all/active/completed/on_hold)
  - useOnboardingInstances()          - Read-only table
  - 2 tables (employees + admins)     - ProgressBar component
  - CRUD modals                       - Status badges
  - Delete confirmation
  - Activity logging
```

### Data Flow

```
Supabase (onboarding_instances table)
         |
         v
subscribeToOnboardingInstances() -- instanceService.ts
         |
         v
useOnboardingInstances() hook -- returns { data, isLoading, error }
         |
         v
NewHiresPanel component
  |-- filter state (all | active | completed | on_hold)
  |-- useMemo: filtered instances
  |-- Table rows: name, email, department, role, status badge, progress bar, start date
  |-- Loading state (spinner)
  |-- Empty state (icon + message)
  |-- Error state (alert)
```

---

## Tech Stack Summary

- **Component:** React 18 functional component with TypeScript
- **Styling:** Tailwind CSS with dark mode (`dark:` variants)
- **Data:** `useOnboardingInstances()` hook (existing, no changes needed)
- **UI Reuse:** `ProgressBar` component from `src/components/ui/`
- **Icons:** Lucide React (`Users` icon for empty state)
- **Testing:** Vitest + React Testing Library

---

## File Structure

### New Files

| File | Purpose | Est. Lines |
|------|---------|------------|
| `src/components/manager/NewHiresPanel.tsx` | Read-only onboarding instances table with status filter | ~150-180 |
| `src/components/manager/NewHiresPanel.test.tsx` | Unit tests for NewHiresPanel rendering, filtering, states | ~150-170 |

### Modified Files

| File | Change Description | Lines Affected |
|------|-------------------|----------------|
| `src/views/ManagerView.tsx` | Replace `UsersPanel` import with `NewHiresPanel`, rename tab label from "Users" to "New Hires", change `activeTab` type from `'users'` to `'new-hires'` | Lines 17, 68, 141-151, 201-204 |
| `src/components/manager/index.ts` | Replace `UsersPanel` export with `NewHiresPanel` export | Line 14 |

### Deleted Files

| File | Reason |
|------|--------|
| `src/components/manager/UsersPanel.tsx` | Replaced by NewHiresPanel -- CRUD admin no longer needed |
| `src/components/manager/UsersPanel.test.tsx` | Tests for deleted component |

### Files NOT Changed (verified no impact)

| File | Reason |
|------|--------|
| `src/hooks/useUsers.ts` | Only consumed by UsersPanel; will become dead code. Safe to leave (or clean up in a follow-up). Not deleting to keep scope minimal. |
| `src/hooks/useOnboardingInstances.ts` | Used as-is, no modifications needed |
| `src/services/supabase/instanceService.ts` | Used as-is via the hook |
| `src/services/supabase/userService.ts` | Still used by authService; no changes |
| `src/types/index.ts` | `OnboardingInstance` type already has all needed fields |

---

## Component Architecture

### NewHiresPanel Component

```
NewHiresPanel
|-- Hook: useOnboardingInstances()
|-- State: filter ('all' | 'active' | 'completed' | 'on_hold')
|-- Derived: filteredInstances (useMemo, filtered by status)
|-- Derived: counts per status (for filter button labels)
|
|-- Render:
|   +-- Header: icon + title + subtitle
|   +-- Filter toggle group: All (N) | Active (N) | Completed (N) | On Hold (N)
|   +-- Loading state (conditional)
|   +-- Error state (conditional)
|   +-- Empty state (conditional, message varies by filter)
|   +-- Table (conditional):
|       +-- thead: Name | Email | Department | Role | Status | Progress | Start Date
|       +-- tbody: one row per filteredInstance
|           +-- Name: employeeName (font-medium)
|           +-- Email: employeeEmail (font-mono, text-xs)
|           +-- Department: department
|           +-- Role: role (badge)
|           +-- Status: badge with color per status
|           +-- Progress: ProgressBar component (compact, no label)
|           +-- Start Date: formatted date or dash
```

### Helper Functions (inside component file)

```typescript
// Status badge colors (extracted from UsersPanel pattern)
function getStatusBadgeClasses(status: string): string
function getStatusLabel(status: string): string
function formatDate(timestamp?: number): string
```

### State Management

- **filter** -- local `useState<'all' | 'active' | 'completed' | 'on_hold'>('all')`
- **filteredInstances** -- `useMemo` derived from `data` + `filter`
- **statusCounts** -- `useMemo` derived from `data`, used for filter button labels
- No external state management needed; no context; no props required

### Props Interface

```typescript
// No props needed -- component is self-contained via useOnboardingInstances()
// Matches pattern of UsersPanel (no props) and RoleManagementPanel (optional callback props)
export function NewHiresPanel(): JSX.Element
```

---

## ManagerView Changes

### Tab Type Change

```typescript
// Before:
const [activeTab, setActiveTab] = useState<'dashboard' | 'roles' | 'users'>('dashboard');

// After:
const [activeTab, setActiveTab] = useState<'dashboard' | 'roles' | 'new-hires'>('dashboard');
```

### Tab Button Change

```typescript
// Before:
<button onClick={() => setActiveTab('users')} ...>Users</button>

// After:
<button onClick={() => setActiveTab('new-hires')} ...>New Hires</button>
```

### Tab Content Change

```typescript
// Before:
{activeTab === 'users' && (
  <div className="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6">
    <UsersPanel />
  </div>
)}

// After:
{activeTab === 'new-hires' && (
  <div className="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6">
    <NewHiresPanel />
  </div>
)}
```

### Import Change

```typescript
// Before:
import { ..., UsersPanel } from '../components/manager';

// After:
import { ..., NewHiresPanel } from '../components/manager';
```

---

## Testing Strategy

### Unit Tests: NewHiresPanel.test.tsx (~10-12 tests)

Tests mock `useOnboardingInstances` via `vi.mock('../../hooks')` following the same pattern as UsersPanel.test.tsx.

**Rendering Tests:**
1. Renders table with instance data (name, email, department, role, status, progress, start date)
2. Renders ProgressBar component for each instance with correct value
3. Renders correct status badge colors for active/completed/on_hold

**Filter Tests:**
4. Shows all instances by default (All filter active)
5. Filters to only active instances when Active filter clicked
6. Filters to only completed instances when Completed filter clicked
7. Filters to only on_hold instances when On Hold filter clicked
8. Filter buttons show correct counts

**State Tests:**
9. Shows loading spinner when isLoading is true
10. Shows error message when error is present
11. Shows empty state when no instances exist
12. Shows filtered empty state when filter yields no results

### Integration Tests (covered by existing ManagerView behavior)

No new integration test file. The ManagerView already renders without its own test file, and the tab wiring is straightforward enough to be covered by the component-level tests plus manual verification.

### No E2E Tests

The feature is a simple UI swap with no new data flows. Visual verification via the dev server is sufficient.

---

## Implementation Notes

### Design Decisions

1. **No props on NewHiresPanel** -- Matches the self-contained pattern of UsersPanel (calls its own hooks). Keeps ManagerView clean.

2. **Keep useUsers hook alive** -- Even though no component imports it after this change, deleting the hook and its tests is out of scope. It can be cleaned up in a future "dead code" sweep.

3. **Use ProgressBar component** -- The existing UsersPanel showed plain "45%" text. The new panel will use the existing `ProgressBar` UI component for a better visual. This is a minor upgrade.

4. **Four-option filter vs. two-option toggle** -- UsersPanel had a binary "All / Currently Onboarding" toggle. The new panel uses four options (All / Active / Completed / On Hold) since we are now showing instances directly and all three statuses are meaningful.

5. **No sorting** -- Deferred to a future enhancement. The default order from Supabase (by created_at desc via the subscription) is sufficient for MVP.

6. **No row click / expandable detail** -- Deferred. Summary row only.

### Patterns Followed

- **Tailwind dark mode:** All colors use `dark:` variants matching existing component patterns
- **Loading state:** Inline spinner with text, same pattern as UsersPanel line 538-545
- **Empty state:** Centered icon + message + subtext, same pattern as UsersPanel line 586-595
- **Table style:** `bg-white dark:bg-slate-800 rounded-lg border` with `overflow-x-auto` wrapper
- **Filter toggle:** Rounded border group with `aria-pressed`, same pattern as UsersPanel line 554-577
- **Status badges:** `getStatusBadgeClasses` and `getStatusLabel` helpers preserved from UsersPanel

### Non-Goals

- **User administration:** Removed entirely. No "New User" button. System user management is deferred.
- **Sorting:** No column header sort. Future enhancement.
- **Search:** No text search. Future enhancement.
- **Row actions:** No edit/delete/pause per instance. Read-only view.
- **Expandable rows:** No click-to-expand step detail. Future enhancement.
- **Pagination:** Not needed for typical onboarding volume (<100 instances).

---

## Risk Assessment

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Breaking existing tests that reference UsersPanel | Low | None | UsersPanel tests are self-contained; deleting them is clean |
| Loss of user admin functionality | Low | Certain | Documented as intentional; can re-add later |
| ManagerView tab rendering regression | Low | Low | Tab wiring is a simple string swap; verified by code review |
| ProgressBar import issue | Low | Low | Component already exists and is exported from `ui/` |
