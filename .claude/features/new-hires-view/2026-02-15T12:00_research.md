# Research: new-hires-view

## Metadata
- **Feature:** new-hires-view
- **Created:** 2026-02-15T12:00
- **Status:** research-complete
- **Researcher:** research-agent

## Feature Context

The manager dashboard currently has three tabs: Dashboard, Roles, and Users. The "Users" tab (`UsersPanel.tsx`) is a full-featured user administration panel that lets managers create, edit, and delete system users (managers, admins, contractors, employees). The user wants to repurpose this tab to instead show **new hires** -- employees who are currently going through onboarding -- with a focus on onboarding status rather than system user management.

### Where It Fits
- The manager view (`ManagerView.tsx`) renders three tabs: Dashboard, Roles, Users
- The Dashboard tab already shows KPI summary cards (Active Onboardings count, Stuck Employees count, Doc Feedback count) but does NOT show a list of individual new hires
- The Users tab currently shows two tables: an "Employees" table and an "Administrators & Managers" table, with CRUD operations for both
- The "New Hire" button on the Dashboard header creates onboarding instances (via `CreateOnboardingModal`)

### Dependencies on Other Features
- Relies on `useOnboardingInstances` hook (already exists and working)
- Relies on `instanceService.ts` for onboarding instance data (already exists)
- The Dashboard tab's KPI cards already consume `onboardingInstances` data

## Requirements

### Functional Requirements
- [ ] FR1: Replace the Users tab content with a "New Hires" view showing employees currently going through onboarding (source: user request)
- [ ] FR2: Display onboarding status for each new hire -- at minimum: name, email, department, role, status (active/completed/on_hold), progress percentage, start date (source: user request)
- [ ] FR3: The view should differentiate from the Dashboard tab -- Dashboard shows aggregate KPIs, the new-hires view shows individual employee onboarding details (source: user request)
- [ ] FR4: Rename the "Users" tab label to "New Hires" (source: user request implies this)
- [ ] FR5: Remove or relocate the system user administration (create/edit/delete users) functionality -- it should NOT be the primary focus of this tab (source: user request)
- [ ] FR6: Consider keeping the "Currently Onboarding" filter or making it the default view since the user wants to see employees in onboarding (source: inferred from user request)

### Technical Requirements
- [ ] TR1: Reuse existing `useOnboardingInstances` hook for data fetching -- already provides all OnboardingInstance data with steps, progress, status
- [ ] TR2: Follow existing component patterns (Tailwind, dark mode support, loading states, responsive design)
- [ ] TR3: Existing tests in `UsersPanel.test.tsx` (12 tests) will need to be updated or replaced to match the new component behavior
- [ ] TR4: The `onboardingInstances` data is already loaded by `useManagerData` in `OnboardingHub.tsx` -- but the current `UsersPanel` loads its own copy via `useOnboardingInstances()` directly. The new component should continue this pattern or accept data via props.

### Constraints
- The `OnboardingInstance` type already contains all needed fields: `employeeName`, `employeeEmail`, `role`, `department`, `progress`, `status`, `startDate`, `steps`, `completedAt`
- The current `UsersPanel` already has onboarding status columns and a "Currently Onboarding" filter toggle -- this validates that the data pipeline works

## Existing Code Analysis

### Project State
- Project exists: YES
- Relevant existing files: 12+ files directly involved

### What the Current UsersPanel Does (636 lines)

The current `UsersPanel.tsx` is a complex component that:

1. **Fetches data from 3 hooks:**
   - `useUsers()` -- all system users (employees, managers, admins)
   - `useRoles()` -- available roles for the create/edit modal
   - `useOnboardingInstances()` -- onboarding instances to show status columns

2. **Renders two tables:**
   - **Employees table** (lines 243-376): Shows employees with columns: Name, Email, Roles, Status (onboarding status badge), Progress (percentage), Start Date, Actions (Edit/Delete)
   - **Admin/Manager table** (lines 378-479): Shows admin/manager users with columns: Name, Email, Roles, Profiles, Actions (Edit/Delete)

3. **Provides CRUD operations:**
   - Create User modal (via `UserModal` component)
   - Edit User modal (via `UserModal` component)
   - Delete User with confirmation dialog (with special warning when user has onboarding instances)
   - Activity logging for all operations

4. **Has a filter toggle:**
   - "All Employees" / "Currently Onboarding (N)" toggle to filter the employee table

5. **Builds an instancesByEmail lookup map** to join User records with OnboardingInstance records by email

### Key Observation

The current UsersPanel employee table already shows exactly the data the user wants (onboarding status, progress, start date). The issue is that it is wrapped in a user administration context with CRUD operations, admin/manager tables, and the "New User" button. The user wants to strip away the administration layer and focus purely on the onboarding status view.

### Code to Reuse

1. **`src/hooks/useOnboardingInstances.ts`**: Provides all OnboardingInstance data. Can be used directly -- no need for the `useUsers` + email join pattern if we simply list instances.
2. **`src/services/supabase/instanceService.ts`**: Already provides `listOnboardingInstances`, `subscribeToOnboardingInstances`, `updateOnboardingInstance`, `updateStepStatus` -- all the operations needed.
3. **`src/types/index.ts` (OnboardingInstance interface)**: Already has all the fields: `employeeName`, `employeeEmail`, `role`, `department`, `progress`, `status`, `startDate`, `steps`, `completedAt`.
4. **Status badge helpers from UsersPanel**: `getStatusBadgeClasses()` and `getStatusLabel()` can be extracted/reused.
5. **`src/components/ui/ProgressBar.tsx`**: Existing progress bar component that could replace the plain "45%" text.
6. **`src/components/onboarding/EmployeeSelector.tsx`**: Shows how onboarding instances are presented in a dropdown -- similar UX pattern.
7. **`ManagerView.tsx` tab structure**: The tab rendering pattern is already established and can be modified.

### Code to Modify

1. **`src/views/ManagerView.tsx`**:
   - Rename "Users" tab to "New Hires"
   - Replace `<UsersPanel />` with the new component
   - The `activeTab` state type changes from `'dashboard' | 'roles' | 'users'` to `'dashboard' | 'roles' | 'new-hires'`

2. **`src/components/manager/UsersPanel.tsx`**:
   - Replace entirely with a new `NewHiresPanel.tsx`, OR
   - Gut and rewrite the component in place
   - Recommendation: Create a new `NewHiresPanel.tsx` file and remove `UsersPanel.tsx`

3. **`src/components/manager/index.ts`**: Update barrel export (swap `UsersPanel` for `NewHiresPanel`)

4. **`src/components/manager/UsersPanel.test.tsx`**: Replace with `NewHiresPanel.test.tsx`

### What to Keep from UsersPanel

The following pieces from the current `UsersPanel.tsx` are worth preserving:
- Status badge color logic (`getStatusBadgeClasses`, `getStatusLabel`)
- Date formatting helper (`formatDate`)
- Loading/empty state patterns
- Dark mode styling patterns
- The filter toggle concept (potentially "Active" / "Completed" / "All")

### What to Remove

- All user CRUD operations (create, edit, delete handlers)
- UserModal integration
- DeleteConfirmationDialog integration
- The admin/manager table
- The `useUsers()` hook dependency
- The `useRoles()` hook dependency
- The instancesByEmail lookup map (no longer needed -- we render instances directly)
- The info card about "New User" vs "New Hire"
- Activity logging for user management operations

### Patterns to Follow

- Component structure: functional component with hooks at top, helpers, then JSX
- Styling: Tailwind with dark mode variants (`dark:bg-slate-800`, etc.)
- Loading states: spinner with message text
- Empty states: centered icon + message + subtext
- Tables: `bg-white dark:bg-slate-800 rounded-lg border` pattern
- Tab navigation: `border-b-2` underline pattern in `ManagerView.tsx`

## What the New Hires View Should Show vs. Dashboard Tab

### Dashboard Tab (existing, no changes)
- **KPI Cards**: Aggregate counts (Active Onboardings, Stuck Employees, Doc Feedback)
- **Suggestions Section**: Individual suggestion cards with approve/reject
- **Activity Feed**: Recent activity log entries

### New Hires Tab (new, replaces Users tab)
- **Individual employee onboarding list**: Table/card view showing each person's name, department, role, status, progress, start date
- **More detail per employee**: Progress bar, step count, time in onboarding
- **Filter/sort capabilities**: Filter by status (active/completed/on_hold), possibly sort by progress or start date
- **No user CRUD**: This is read-only monitoring, not administration

The key differentiator: Dashboard = aggregate metrics, New Hires = per-employee drill-down.

## Question: What Happens to User Administration?

The current Users tab has legitimate functionality (creating/editing/deleting system users). Removing it entirely means there is no place to manage managers, admins, or contractors.

### Options:
1. **Remove it entirely** -- User administration is done via Supabase dashboard or future admin panel
2. **Move it to a separate, less prominent location** -- e.g., a settings page or an admin-only route
3. **Keep a small "Manage Users" link/button** that opens the old UserModal for creating system users

### Recommendation:
Option 1 (remove entirely) is simplest and matches the user's request. The "New User" functionality for system users (managers/admins) is rarely used -- the common operation is "New Hire" which already lives on the Dashboard header. If user administration is needed later, it can be re-added as a separate feature.

## Constraints

### Performance
- `useOnboardingInstances()` already handles Supabase Realtime subscriptions with debounced re-fetch (300ms) -- no performance concern
- The hook already supports conditional enabling via the `enabled` parameter
- Instance data includes nested steps (via `*, instance_steps(*)` select) -- this is slightly heavier than needed for a list view, but the data is already loaded by other parts of the app

### Platform
- Must support dark mode (Tailwind `dark:` variants)
- Must be responsive (mobile-first, existing breakpoint patterns: `md:`, `lg:`, `2xl:`)
- Must work with existing auth context (`useAuth()` for manager verification)

### Dependencies
- No new npm dependencies needed
- All required hooks and services already exist
- The `OnboardingInstance` type already has all needed fields

## Risk Assessment

### Technical Risks
| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| Loss of user admin functionality | Low | Certain | Document that user admin was removed; can be re-added later |
| Breaking existing tests | Low | High | Replace `UsersPanel.test.tsx` with `NewHiresPanel.test.tsx` |
| Missing data fields for new view | Low | Low | `OnboardingInstance` already has name, email, dept, role, progress, status, startDate, steps |
| Tab state URL not bookmarkable | Low | Low | Hash routing already does not track tab state -- existing behavior |

### Complexity
- **Level:** Simple
- **Rationale:** This is primarily a UI replacement. All data infrastructure (hooks, services, types) already exists. The new component is simpler than what it replaces (read-only table vs. full CRUD panel). The main work is creating a clean new component and updating the tab wiring in `ManagerView.tsx`.

## Open Questions

- [x] Q1: Should the new-hires view be read-only, or should managers be able to take actions (e.g., mark as on_hold, delete an instance)?
  - Recommendation: Start read-only. Action capabilities can be added later. The user specifically asked to "see onboarding status, not manage system users."
  - Status: RESOLVED (defaulting to read-only)

- [x] Q2: What happens to the user administration functionality?
  - Recommendation: Remove it. The "New Hire" button on the Dashboard header already handles the most common operation. System user administration (adding managers/admins) is an edge case that can be handled via Supabase dashboard.
  - Status: RESOLVED (removing)

- [x] Q3: Should the tab be called "New Hires" or something else?
  - Recommendation: "New Hires" matches the "New Hire" button and the user's language.
  - Status: RESOLVED

- [x] Q4: Should completed onboardings be shown, or only active ones?
  - Recommendation: Show all by default with a status filter. This gives managers a complete picture with the option to focus on active only.
  - Status: RESOLVED (all with filter)

- [x] Q5: How much detail per employee? Just a summary row, or expandable detail?
  - Recommendation: Summary row in a table (like current UsersPanel employee table). Expandable detail is a future enhancement.
  - Status: RESOLVED (summary row)

## Recommended Approach

### Implementation Strategy

**Replace UsersPanel with a new NewHiresPanel component.**

The new `NewHiresPanel` will be a read-only view that directly consumes `useOnboardingInstances()` data and renders a table of employees with their onboarding status. This is dramatically simpler than the current `UsersPanel` (which has CRUD, modals, multiple tables, user-instance joining, etc.).

**Key design decisions:**
1. Use `useOnboardingInstances()` directly (no need for `useUsers()` + email join)
2. Render a single table with columns: Name, Email, Department, Role, Status, Progress, Start Date
3. Include a filter control for status: All / Active / Completed / On Hold
4. No CRUD operations -- read-only monitoring view
5. Reuse status badge styling from the existing UsersPanel

### Order of Work

1. **Create `NewHiresPanel.tsx`** in `src/components/manager/`
   - Import `useOnboardingInstances` hook
   - Render a table of OnboardingInstance records
   - Include status filter (All / Active / Completed / On Hold)
   - Use existing badge/progress styling patterns
   - Support loading, empty, and error states

2. **Update `ManagerView.tsx`**
   - Change tab label from "Users" to "New Hires"
   - Change `activeTab` state type to use `'new-hires'` instead of `'users'`
   - Import `NewHiresPanel` instead of `UsersPanel`

3. **Update `src/components/manager/index.ts`**
   - Export `NewHiresPanel` instead of `UsersPanel`

4. **Create `NewHiresPanel.test.tsx`**
   - Test rendering of onboarding instances in table
   - Test status filter functionality
   - Test loading and empty states
   - Test status badge display

5. **Remove old files**
   - Delete `UsersPanel.tsx` (replaced by `NewHiresPanel.tsx`)
   - Delete `UsersPanel.test.tsx` (replaced by `NewHiresPanel.test.tsx`)

### What to Defer

- **Expandable row detail** (click on a row to see individual steps) -- future enhancement
- **Actions** (pause/resume/delete onboarding) -- future enhancement
- **Sorting** (click column headers to sort) -- future enhancement, nice to have but not needed for MVP
- **Search** (search by employee name/email) -- future enhancement
- **Re-adding user administration** -- separate feature if ever needed

### Estimated Scope

- **New files:** 2 (NewHiresPanel.tsx, NewHiresPanel.test.tsx)
- **Modified files:** 2 (ManagerView.tsx, manager/index.ts)
- **Deleted files:** 2 (UsersPanel.tsx, UsersPanel.test.tsx)
- **Net line change:** Likely a significant reduction (new component ~150-200 lines vs. current 636 lines)

## Files Referenced in This Research

| File | Path | Relevance |
|------|------|-----------|
| UsersPanel.tsx | `/home/sanjay/Workspace/onboarding/src/components/manager/UsersPanel.tsx` | Component being replaced |
| UsersPanel.test.tsx | `/home/sanjay/Workspace/onboarding/src/components/manager/UsersPanel.test.tsx` | Tests being replaced |
| ManagerView.tsx | `/home/sanjay/Workspace/onboarding/src/views/ManagerView.tsx` | Parent that renders the tabs and will be modified |
| OnboardingHub.tsx | `/home/sanjay/Workspace/onboarding/src/components/OnboardingHub.tsx` | Root component that manages data flow |
| instanceService.ts | `/home/sanjay/Workspace/onboarding/src/services/supabase/instanceService.ts` | Service providing onboarding instance data |
| useOnboardingInstances.ts | `/home/sanjay/Workspace/onboarding/src/hooks/useOnboardingInstances.ts` | Hook for subscribing to onboarding instances |
| useManagerData.ts | `/home/sanjay/Workspace/onboarding/src/hooks/useManagerData.ts` | Centralized manager data hook |
| useUsers.ts | `/home/sanjay/Workspace/onboarding/src/hooks/useUsers.ts` | User hook (will no longer be needed by this tab) |
| KPISection.tsx | `/home/sanjay/Workspace/onboarding/src/components/manager/KPISection.tsx` | Dashboard KPI cards (for understanding differentiation) |
| types/index.ts | `/home/sanjay/Workspace/onboarding/src/types/index.ts` | OnboardingInstance type definition |
| manager/index.ts | `/home/sanjay/Workspace/onboarding/src/components/manager/index.ts` | Barrel export to update |
| UserModal.tsx | `/home/sanjay/Workspace/onboarding/src/components/modals/UserModal.tsx` | Modal no longer needed by this tab |

## Next Step

**All questions resolved.** Run `/plan new-hires-view` to create the implementation plan.
