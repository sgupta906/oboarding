# Plan: darkmode-batch (Bugs #22-27)

## Metadata
- **Feature:** darkmode-batch
- **Created:** 2026-02-16T23:00
- **Status:** plan-complete
- **Based on:** 2026-02-16T23:00_research.md

## Architecture Overview

This is a CSS-only batch fix. No logic, state, or data flow changes. The pattern is identical across all 6 components:

```
Component.tsx (add dark: Tailwind classes)
     |
     v
Component.test.tsx (verify dark: classes present + light mode regression)
```

All modal-based components (ReportStuckModal, DeleteConfirmDialog) inherit container dark mode from ModalWrapper (`dark:bg-slate-800` body, `dark:bg-slate-700` footer). They only need internal element styling (text, borders, alert backgrounds).

## Tech Stack (No Changes)
- Tailwind CSS 3 with `darkMode: 'class'`
- Vitest + React Testing Library for tests
- No new dependencies

## Dark Mode Color Palette (Reference)

| Use Case | Light | Dark |
|----------|-------|------|
| Primary text | `text-slate-900` | `dark:text-white` |
| Secondary text | `text-slate-700` | `dark:text-slate-200` |
| Muted text | `text-slate-500`/`text-slate-600` | `dark:text-slate-400` |
| Input/select bg | (white default) | `dark:bg-slate-700` |
| Borders | `border-slate-200`/`border-slate-300` | `dark:border-slate-600` |
| Colored alert bg | `bg-{color}-50` | `dark:bg-{color}-900/20` |
| Colored alert border | `border-{color}-200` | `dark:border-{color}-700` or `dark:border-{color}-800` |
| Colored text | `text-{color}-600`/`text-{color}-700` | `dark:text-{color}-300`/`dark:text-{color}-400` |

## File Structure

### New Files (Tests)
| File | Purpose |
|------|---------|
| `src/components/manager/KPISection.test.tsx` | Dark mode + rendering tests for KPISection |
| `src/components/modals/ReportStuckModal.test.tsx` | Dark mode + rendering tests for ReportStuckModal |
| `src/components/onboarding/StepTimeline.test.tsx` | Dark mode + rendering tests for StepTimeline |
| `src/components/onboarding/WelcomeHeader.test.tsx` | Dark mode + option styling tests for WelcomeHeader |

### Modified Files
| File | Changes |
|------|---------|
| `src/components/manager/KPISection.tsx` | Line 89: `gray-700` -> `slate-700 dark:text-slate-200`; Line 100: `gray-300` -> `slate-300 dark:border-slate-600 dark:bg-slate-700 dark:text-white` |
| `src/components/modals/ReportStuckModal.tsx` | 16 elements: add dark: variants to cancel button, rose alert, step info, blue info, disclaimer |
| `src/components/templates/DeleteConfirmDialog.tsx` | 3 elements: cancel button, message text, sub-text |
| `src/components/onboarding/ActionBar.tsx` | 8 elements: border, disabled state, completed badge, mark incomplete, resume, stuck, suggest edit |
| `src/components/onboarding/StepTimeline.tsx` | 5 elements: main gradient line, completed connector, pending connector, completion footer, completion text |
| `src/components/onboarding/WelcomeHeader.tsx` | Lines 68-72: add `className="text-slate-900 bg-white"` to all `<option>` elements |
| `src/components/templates/DeleteConfirmDialog.test.tsx` | Extend: add dark mode describe block (~3 tests) |
| `src/components/onboarding/ActionBar.test.tsx` | Extend: add dark mode describe block (~3 tests) |

## Testing Strategy

### Unit Tests (~18 new tests across 6 files)

Each component gets a "dark mode" describe block following the SuggestEditModal.test.tsx pattern:
- Query elements by accessible label/role/text
- Assert `element.className` contains expected `dark:` strings
- One regression test per component verifying light mode classes remain

| Component | New Tests | Pattern |
|-----------|-----------|---------|
| KPISection | 3 | Render with profiles, check label + select dark classes, regression |
| ReportStuckModal | 3 | Check cancel button, rose alert, blue info box dark classes, regression |
| DeleteConfirmDialog | 3 | Check cancel button, message, sub-text dark classes, regression |
| ActionBar | 3 | Check completed badge, mark incomplete, border dark classes, regression |
| StepTimeline | 3 | Check completion footer, connector line dark classes, regression |
| WelcomeHeader | 3 | Check option elements have explicit text-slate-900, check select still has text-white, regression |

**Total:** ~18 new tests. Combined with 474 existing = ~492 tests.

### No Integration or E2E Tests Needed
- These are purely CSS class additions with no behavioral changes
- Unit tests verifying class presence are sufficient

## Implementation Notes

### Decisions
1. **Batch approach:** All 6 bugs in one pipeline run since they share the exact same pattern.
2. **TDD:** Write failing tests first (check for `dark:` classes that don't exist yet), then add the classes.
3. **KPISection gray normalization:** Change `gray-` to `slate-` as part of this fix per TR2.
4. **WelcomeHeader special case:** Not a `dark:` class issue -- it's a native `<option>` element styling issue. Fix with explicit `text-slate-900 bg-white` on options.

### Patterns
- Use `expect(element.className).toContain('dark:...')` for assertions.
- Query elements by `getByRole`, `getByLabelText`, `getByText`, or `closest('div')` for container elements.
- For elements not directly queryable (connectors, timeline lines), use `container.querySelector` with known class patterns.

### Non-Goals
- No visual regression testing (Playwright screenshots) -- class presence tests are sufficient
- No changes to ModalWrapper or other components outside the 6 listed
- No refactoring beyond gray->slate normalization in KPISection
- Bugs outside #22-27 are explicitly out of scope
