version: '3.8'

services:
  firebase-emulator:
    image: node:20-alpine
    working_dir: /app
    volumes:
      - .:/app
      - firebase_data:/firebase_data
    ports:
      # Firestore Emulator
      - "8080:8080"
      # Auth Emulator
      - "9099:9099"
      # Storage Emulator
      - "9199:9199"
      # Pub/Sub Emulator
      - "8085:8085"
      # Emulator UI
      - "4000:4000"
    environment:
      FIREBASE_DATABASE_EMULATOR_HOST: 127.0.0.1:8080
      FIRESTORE_EMULATOR_HOST: 127.0.0.1:8080
      FIREBASE_AUTH_EMULATOR_HOST: 127.0.0.1:9099
      FIREBASE_STORAGE_EMULATOR_HOST: 127.0.0.1:9199
      PUBSUB_EMULATOR_HOST: 127.0.0.1:8085
    command: >
      sh -c "npm install -g firebase-tools &&
             firebase emulators:start --import=/firebase_data --export-on-exit=/firebase_data"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  firebase_data:
    driver: local
